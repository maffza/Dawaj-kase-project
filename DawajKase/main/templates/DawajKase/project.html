{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ campaign.title }} project</title>
    <link rel="stylesheet" href="{% static 'styles/styles.css' %}">
    <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
    <link rel="icon" href="{% static 'media/logo.png' %}" type="image/png">

</head>
<body>
    <!-- Header (Same as main page) -->
    {% include 'DawajKase/header.html' %}

    <!-- Project Content -->
    <main>
        <div class="container">
            <div class="project-details">
                <div class="project-image">
                    <div class="image-placeholder">
                        {% if campaign.imageURL %}
                            <img style="object-fit: contain; object-position: center; width: 100%; height: 100%;" src={% static campaign.imageURL %}/>
                        {% endif %}
                    </div>
                </div>
                <div class="project-info">
                    <div id="qrcode" style="float: right;"></div>
                    <h1>{{ campaign.title }}</h1>
                    <p>by <a href="#">{% if creator %} {{creator.firstName}} {{creator.lastName}} {% endif %}</a></p>
                    <p>{{ campaign.shortDescription }}</p>
                    <div class="funding-info">
                        <p><strong>${{campaign.currentMoneyAmount}} pledged</strong> of ${{campaign.targetMoneyAmount}} goal</p>
                        <p><strong>0 backers</strong></p>
                        <p><strong id="daysLeft"></strong> to go</p>
                    </div>
                    <a href="/donate/{{campaign.id}}">
                        <button class="back-project">Back this project</button>
                    </a>
                    {% if userData %}
                    <a href="/favourite/{{campaign.id}}">
                        <button class="back-project">
                            {% if isFavourited %} Unfavourite {% else %} Favourite {% endif %}
                        </button>
                    </a>
                    {% endif %}
                </div>
            </div>
            <div class="project-description">
                <h2>About</h2>
                <p>{{ campaign.description }}</p>
            </div>

            <br/><br/>
            <h2>Donations</h2>
            <br/>
            {% for donation in donations %}
                <strong>{{donation.username}}</strong>
                <p>{{donation.message}}</p><br/>
            {% endfor %}
            <h2>Comments</h2>
            <br/><br/>
            <br/>
            {% for comment in comments %}
                <strong>{{comment.username}}</strong>
                <p>{{comment.commentText}}</p><br/>
            {% endfor %}
        </div>
    </main>

    <!-- Footer (Same as main page) -->
    <footer>
        <div class="container">
            <div class="footer-links">
                <a href="#">About</a>
                <a href="#">Help</a>
                <a href="#">Terms</a>
                <a href="#">Privacy</a>
            </div>
        </div>
    </footer>

    <script>
        const endDate = new Date("{{ campaign.endDate|date:'Y-m-d' }}");
        const today = new Date();
        const timeDifference = endDate - today;

        const daysRemaining = Math.ceil(timeDifference / (1000 * 60 * 60 * 24));

        document.getElementById("daysLeft").textContent = daysRemaining + " days"

        new QRCode(document.getElementById("qrcode"), {
            text: "https://dawajkase.net/project/{{campaign.id}}",
            width: 128,
            height: 128,
            colorDark: "#000000",
            colorLight: "#ffffff",       
            correctLevel: QRCode.CorrectLevel.H
          });
    </script>
</body>
</html>
